<form method="POST" action="/teacher/createOrderingExercise/<%= testID %>/<%= direction %>">
    <div style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
        <div>
            <h2>Új feladat hozzáadása</h2>
        </div>
        <div>
            <h4>A feladat szövege:</h4>
            <input type="text" name="exerciseText" style="width: 300px">
        </div>
        <div>
            <h4>Adja meg a helyes sorrendet:</h4>
            <p id="direction" style="display: none;"><%= direction %></p>
        </div>
        <div id="container" style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
            <div id="first" style="display: flex; flex-direction: row;">
                <% for(let i=0; i<images.length; i++){ %>
                <div class="initialContainer"  style="border: solid gray 1px; background-color: white; width: 180px; height: 130px;">
                    <div class = "item" draggable="true" value="<%= images[i].image_id %>">
                    <img src="data:image/jpeg;base64, <%= images[i].image_object.toString('base64') %>"  style="width: 180px; height: 130px;">
                    </div>
                </div>
                <% } %>
            </div>
            <div id="second" style="display: flex; flex-direction: row; margin-top: 20px;">
                <% for(let i=0; i<images.length; i++){ %>
                <div class="finalContainer" style="border: solid gray 1px; background-color: white; width: 180px; height: 130px;">
                </div>
                <% } %>
            </div>
        </div>

        <div style="margin-top: 20px;">
            <input id="numbersField" type="text" name="answer" style="display: none;">
            <button id="checkButton">Hozzáad</button>
        </div>
    </div>
</form>

<script>
    const items = document.getElementsByClassName("item");
    const initialContainers = document.getElementsByClassName("initialContainer");
    const finalContainers = document.getElementsByClassName("finalContainer");
    const button = document.getElementById("checkButton");

    for(item of items){
        item.addEventListener("dragstart", function(e){
            let selected = e.target.closest('.item');
            console.log(selected);

            for(initial of initialContainers){
                initial.addEventListener("dragover",function(e){
                    e.preventDefault();
                });
                initial.addEventListener("drop",function(e){
                    let targetContainer = e.target.closest(".initialContainer");
                    let hasItem = targetContainer.querySelectorAll("div");
                    console.log(hasItem);

                    if (targetContainer && hasItem.length==0) {
                        console.log("append1");
                        console.log(selected);
                        targetContainer.appendChild(selected);
                        selected = null;
                    }
                });
            }

            for(final of finalContainers){
                final.addEventListener("dragover",function(e){
                    e.preventDefault();
                });
                final.addEventListener("drop",function(e){
                    let targetContainer = e.target.closest(".finalContainer");
                    let hasItem = targetContainer.querySelectorAll("div");
                    console.log(hasItem);

                    if (targetContainer && hasItem.length==0) {
                        console.log("append2");
                        console.log(selected);
                        targetContainer.appendChild(selected);
                        selected = null;
                    }
                });
            }
        });
    }

    button.addEventListener('click',function(e){
        let numbers="";
        e.preventDefault();
        const finalContainers = document.getElementsByClassName("finalContainer");
        for(final of finalContainers){
            const hasItem = final.querySelectorAll("div");
            if(hasItem.length==0){
                alert("!");
                break;
            }
            const item = hasItem[0];
            numbers=numbers+item.getAttribute("value")+" ";
            console.log(numbers);
        }
        let numbersField = document.getElementById("numbersField");
        numbersField.setAttribute("value",numbers);
        console.log(numbersField.getAttribute("value"));
        const form = e.target.closest("form");
        form.submit();
    })

    const firstDiv=document.getElementById("first");
    const secondDiv=document.getElementById("second");
    const direction=document.getElementById("direction");
    const container=document.getElementById("container");

    if(direction.textContent == "vertical"){
        firstDiv.style.flexDirection = "column";
        secondDiv.style.flexDirection = "column";
        secondDiv.style.marginTop = "0px";
        secondDiv.style.marginLeft = "70px";
        container.style.flexDirection="";
    }
</script>